<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{{ page.title }}{% if site.title %} | {{ site.title }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_newlines | strip | escape }}">
  {% if site.keywords %}
    <meta name="keywords" content="{{ site.keywords | escape }}">
  {% endif %}
  {% if site.canonical %}
    <link rel="canonical" href="{{ site.canonical | escape }}"/>
  {% endif %}
  <meta name="robots" content="index,follow">

  <!-- Open Graph / Twitter (basic) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ page.title }}{% if site.title %} | {{ site.title }}{% endif %}">
  <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_newlines | strip | escape }}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    <meta name="twitter:card" content="summary_large_image">
  {% else %}
    <meta name="twitter:card" content="summary">
  {% endif %}
  <meta name="twitter:title" content="{{ page.title }}{% if site.title %} | {{ site.title }}{% endif %}">
  <meta name="twitter:description" content="{{ page.excerpt | default: site.description | strip_newlines | strip | escape }}">

  <!-- Favicon -->
  <link rel="icon" href="{{ '/assets/img/newten.svg?v=5' | relative_url }}" type="image/png">

  <!-- Base theme -->
  {% if site.auto_dark_mode %}
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/publications.css' | relative_url }}">
  {% else %}
    <link rel="stylesheet" href="{{ '/assets/css/style-no-dark-mode.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/publications-no-dark-mode.css' | relative_url }}">
  {% endif %}

  <!-- Shared site styles -->
  <link rel="stylesheet" href="{{ '/assets/css/navbar.css' | relative_url }}">

  <!-- Extra CSS (merge layout + page; supports string or list; keeps order; dedupes) -->
  {% assign all_css = '' | split: '' %}
  {% if layout.extra_css %}
    {% assign layout_css = layout.extra_css %}
    {% if layout_css.first == nil %}
      {% assign layout_css = layout_css | split: ',' %}
    {% endif %}
    {% assign all_css = all_css | concat: layout_css %}
  {% endif %}
  {% if page.extra_css %}
    {% assign page_css = page.extra_css %}
    {% if page_css.first == nil %}
      {% assign page_css = page_css | split: ',' %}
    {% endif %}
    {% assign all_css = all_css | concat: page_css %}
  {% endif %}
  {% assign all_css = all_css | uniq %}
  {% for f in all_css %}
    <link rel="stylesheet" href="{{ '/assets/css/' | append: f | strip | relative_url }}?v={{ site.time | date: '%s' }}">
  {% endfor %}

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,500;1,600&family=Ubuntu+Mono&display=swap" rel="stylesheet">

  <!-- Icon fonts (Academicons + FontAwesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css"
        integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
        integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">

  <!-- MathJax configuration -->
  <script>
    window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      packages: {
        '[+]': ['noerrors','noundefined','bm']   // ‚Üê add bm here
      }
    },
      options: {
        processHtmlClass: 'mathjax-process',
        ignoreHtmlClass: 'tex2jax_ignore',
        skipHtmlTags: ['script','noscript','style','textarea','pre','code']
      },
      loader: { load: ['[tex]/noerrors','[tex]/noundefined'] },
      svg: { fontCache: 'global' }
    };
  </script>

  <!-- MathJax macros must load AFTER config but BEFORE MathJax -->
  <script src="{{ '/assets/js/mathjax-macros.js' | relative_url }}"></script>

  <!-- MathJax v3 core -->
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/input/tex/extensions/bm.js"></script>

</head>

<body>
  <a href="#main-content" class="sr-only sr-only-focusable">Skip to content</a>

  <nav class="navbar" role="navigation" aria-label="Main Navigation">
    <ul class="nav-list">
      <li class="nav-item"><a href="{{ '/' | relative_url }}">Home</a></li>
      <li class="nav-item"><a href="{{ '/blog/' | relative_url }}">Blog</a></li>
    </ul>
  </nav>

  <main id="main-content" class="page-content" role="main">
    {{ content }}
  </main>

  <!-- Ensure MathJax re-renders after DOM insertion -->
  <script>
  document.addEventListener("DOMContentLoaded", function() {
      if (window.MathJax && window.MathJax.typesetPromise) {
          MathJax.typesetPromise();
      }
  });
  </script>

  <script src="{{ '/assets/js/scale.fix.js' | relative_url }}" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".highlighter-rouge").forEach(block => {
        if (block.querySelector(".copy-btn")) return;

        const button = document.createElement("button");
        button.className = "copy-btn";
        button.textContent = "Copy";

        button.addEventListener("click", async () => {
          const code = block.innerText.trim();
          try {
            await navigator.clipboard.writeText(code);
            button.classList.add("copied");
            setTimeout(() => button.classList.remove("copied"), 1500);
          } catch {
            button.textContent = "Error";
          }
        });

        block.appendChild(button);
      });
    });
  </script>

</body>
</html>
